# Hostname: yichi-thinkpad
# System Type: Linux
# Machine Type: x86_64
# Processor: x86_64
#INFO: **** input file is /home/yichi/research/software/cs_afqmc/ad_afqmc/lnocc/test/water/lno_water.py ****
import sys, os
import numpy as np
from functools import reduce
from pyscf.lib import logger
from ad_afqmc.lno.cc import LNOCCSD
from ad_afqmc import lno_ccsd
from pyscf import gto, scf, mp, cc
from ad_afqmc.lno.base import lno
from ad_afqmc.lno.afqmc import LNOAFQMC

log = logger.Logger(sys.stdout, 6)

atoms = '''
O        0.000000    0.000000    0.117790
H        0.000000    0.755453   -0.471161
H        0.000000   -0.755453   -0.471161
'''

mol = gto.M(atom=atoms, basis="ccpvdz", verbose=4)
mf = scf.RHF(mol).density_fit()
mf.kernel()

# frozen = 0
# mmp = mp.MP2(mf,frozen=frozen)
# mmp.kernel()[0]

# # cc
# mycc = cc.CCSD(mf)
# mycc.kernel()
# et = mycc.ccsd_t()

# fci
#cisolver = fci.FCI(mf)
#fci_ene, fci_vec = cisolver.kernel()

# print(f'rhf energy is {mf.e_tot}')
# print(f"ccsd energy is {mycc.e_tot}")
# print(f"ccsd_t energy is {mycc.e_tot+et}")
# print(f"ccsd correlation energy is {mycc.e_corr}")

options = {'n_eql': 5,
           'n_prop_steps': 30,
            'n_ene_blocks': 1,
            'n_sr_blocks': 10,
            'n_blocks': 20,
            'n_walkers': 50,
            'seed': 2,
            'walker_type': 'rhf',
            'trial': 'cisd',
            'dt':0.01,
            'ad_mode':None,
            }


thresh = 1.00e-05
lno_ccsd.run_lno_ccsd_afqmc(mf,thresh,[],options,1e-6,8)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='yichi-thinkpad', release='4.4.0-26100-Microsoft', version='#1882-Microsoft Fri Jan 01 08:00:00 PST 2016', machine='x86_64')  Threads 12
Python 3.10.16 | packaged by conda-forge | (main, Dec  5 2024, 14:16:10) [GCC 13.3.0]
numpy 1.24.3  scipy 1.14.1  h5py 3.12.1
Date: Thu Jun 19 14:21:39 2025
PySCF version 2.8.0
PySCF path  /home/yichi/research/software/lno_pyscf
GIT HEAD (branch master) ef75f4190e4de208685670651dc6c467f72b6794

[ENV] PYSCF_EXT_PATH /home/yichi/research/software/pyscf
[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 3
[INPUT] num. electrons = 10
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 O      0.000000000000   0.000000000000   0.117790000000 AA    0.000000000000   0.000000000000   0.222590840213 Bohr   0.0
[INPUT]  2 H      0.000000000000   0.755453000000  -0.471161000000 AA    0.000000000000   1.427599269981  -0.890365250576 Bohr   0.0
[INPUT]  3 H      0.000000000000  -0.755453000000  -0.471161000000 AA    0.000000000000  -1.427599269981  -0.890365250576 Bohr   0.0

nuclear repulsion = 9.18919322930975
number of shells = 11
number of NR pGTOs = 40
number of NR cGTOs = 24
basis = ccpvdz
ecp = {}
CPU time:         1.03


******** <class 'pyscf.df.df_jk.DFRHF'> ********
method = DFRHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
diis_damp = 0
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 50
direct_scf = False
chkfile to save SCF result = /tmp/tmprhlp0chu
max_memory 4000 MB (current use 146 MB)
Set gradient conv threshold to 3.16228e-05
Initial guess from minao.
******** <class 'pyscf.df.df.DF'> ********
auxbasis = None
max_memory = 4000
Default auxbasis cc-pvdz-jkfit is used for O ccpvdz
Default auxbasis cc-pvdz-jkfit is used for H ccpvdz
init E= -75.8567775490721
  HOMO = -0.476825796928878  LUMO = 0.100686864974181
cycle= 1 E= -75.9877488303427  delta_E= -0.131  |g|= 0.448  |ddm|= 1.31
  HOMO = -0.412736317476258  LUMO = 0.186378593963348
cycle= 2 E= -76.0176852727411  delta_E= -0.0299  |g|= 0.228  |ddm|= 0.371
  HOMO = -0.498306554825319  LUMO = 0.180774658518255
cycle= 3 E= -76.0265633434094  delta_E= -0.00888  |g|= 0.0245  |ddm|= 0.131
  HOMO = -0.491299781060008  LUMO = 0.185546558740081
cycle= 4 E= -76.0267323991193  delta_E= -0.000169  |g|= 0.00589  |ddm|= 0.0181
  HOMO = -0.492829572473259  LUMO = 0.185475505213298
cycle= 5 E= -76.0267464584418  delta_E= -1.41e-05  |g|= 0.00098  |ddm|= 0.00648
  HOMO = -0.493184600467524  LUMO = 0.185391854049506
cycle= 6 E= -76.0267469443264  delta_E= -4.86e-07  |g|= 0.000151  |ddm|= 0.00138
  HOMO = -0.493239657696566  LUMO = 0.185385360430474
cycle= 7 E= -76.0267469568116  delta_E= -1.25e-08  |g|= 1.68e-05  |ddm|= 0.000267
  HOMO = -0.49323835427177  LUMO = 0.185384560927473
cycle= 8 E= -76.0267469569757  delta_E= -1.64e-10  |g|= 4.01e-06  |ddm|= 2.74e-05
  HOMO = -0.49323731836676  LUMO = 0.185384595382665
Extra cycle  E= -76.0267469569855  delta_E= -9.76e-12  |g|= 1.75e-06  |ddm|= 5.62e-06
converged SCF energy = -76.0267469569855
no_type = ie
lo_type = pm
LOs span exactly the occupied space.
Using single-LO fragment
nfrag = 5  nlo = 5
frag_atmlist = None
frag_lolist = [[0], [1], [2], [3], [4]]
frag_nonvlist = None
Lov is saved to /tmp/emwbjqqn
########### running fragment 1 ##########
    impsol:  1 LOs  5/24 MOs  3 occ  2 vir
    CPU time for imp sol - eri          0.00 sec, wall time      0.00 sec
    CPU time for imp sol - mp2 amp      0.03 sec, wall time      0.00 sec
    CPU time for imp sol - mp2 ene      0.00 sec, wall time      0.00 sec
    CPU time for imp sol - cc  amp      0.03 sec, wall time      0.04 sec
    CPU time for imp sol - cc  ene      0.00 sec, wall time      0.00 sec
# lno-ccsd correlation energy is: -0.00029573731775505357
# Generating Cholesky Integrals
# frozen orbitals are [ 0  1  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23]
# local active orbitals are [2 3 4 5 6]
# local active space size 5
# loc_eris shape: (25, 25)
# chol shape: (15, 25)
# Finished calculating Cholesky integrals

# Size of the correlation space:
# Number of electrons: (3, 3)
# Number of basis functions: 5
# Number of Cholesky vectors: 15

# Hostname: yichi-thinkpad
# System Type: Linux
# Machine Type: x86_64
# Processor: x86_64
# Number of MPI ranks: 8
#
# norb: 5
# nelec: (3, 3)
#
# n_eql: 5
# n_prop_steps: 30
# n_ene_blocks: 1
# n_sr_blocks: 10
# n_blocks: 20
# n_walkers: 50
# seed: 2
# walker_type: rhf
# trial: cisd
# dt: 0.01
# n_exp_terms: 6
# orbital_rotation: True
# do_sr: True
# symmetry: False
# save_walkers: False
# ene0: 0.0
# free_projection: False
# n_batch: 1
# maxError: 0.001
# use_gpu: False
#
# Hostname: yichi-thinkpad
# System Type: Linux
# Machine Type: x86_64
# Processor: x86_64
# afqmc propagation with ccsd trial using 400 walkers
# system relaxing and appraching the equilibrium of the Markov Chain
# eql_step 	 sys_energy 	 zero_orb_cr 	 hf_orb_cr 	 ccsd_orb_cr 	 tot_orb_cr 	 wall_time
    0	 	 -76.029168	 0.000000	 0.000000	 -0.000296	 -0.000296	    0.00
    1	 	 -76.029160	 0.000392	 -0.000290	 -0.000398	 -0.000296	   37.19 
    2	 	 -76.029175	 0.000403	 -0.000295	 -0.000404	 -0.000296	   62.45 
    3	 	 -76.029167	 0.000405	 -0.000293	 -0.000406	 -0.000295	   63.29 
    4	 	 -76.029167	 0.000410	 -0.000295	 -0.000410	 -0.000295	   64.12 
    5	 	 -76.029175	 0.000394	 -0.000291	 -0.000399	 -0.000296	   64.89 
# Sampling sweeps:
# iter 	 sys_energy 	 err 	 zero_orb_cr 	 err 	 hf_orb_cr 	 err 	 ccsd_orb_cr 	 err 	 tot_orb_cr 	 err 	 time
   0   -76.029167     None     0.000414     None     -0.000299     None     -0.000412     None     -0.000296     None    0.81 
   2   -76.029167     None     0.000416   0.000416   -0.000300   0.000004   -0.000412   0.000003   -0.000296   0.000000  47.93 
   4   -76.029167     None     0.000410   0.000410   -0.000298   0.000002   -0.000408   0.000002   -0.000296   0.000000  49.58 
   6   -76.029167     None     0.000410   0.000410   -0.000297   0.000002   -0.000408   0.000002   -0.000296   0.000000  51.36 
   8   -76.029167   0.000000   0.000411   0.000411   -0.000298   0.000002   -0.000409   0.000002   -0.000295   0.000000  52.88 
  10   -76.029167   0.000000   0.000410   0.000410   -0.000297   0.000001   -0.000408   0.000002   -0.000295   0.000000  54.52 
  12   -76.029167     None     0.000410   0.000410   -0.000297   0.000001   -0.000409   0.000002   -0.000295   0.000000  56.17 
  14   -76.029167     None     0.000409   0.000409   -0.000297   0.000001   -0.000408   0.000001   -0.000295   0.000000  57.86 
  16   -76.029167   0.000000   0.000410   0.000410   -0.000297   0.000001   -0.000408   0.000001   -0.000295   0.000000  59.52 
  18   -76.029167   0.000000   0.000409   0.000409   -0.000297   0.000001   -0.000408   0.000001   -0.000295   0.000000  61.07 
# Number of outliers in post: 0 
#
# Mean: -7.60291672e+01
# Block size    # of blocks         Mean                Error
      1              160       -7.60291672e+01       0.000000e+00
      2               80       -7.60291672e+01       0.000000e+00
      5               32       -7.60291672e+01       0.000000e+00
     10               16       -7.60291672e+01       0.000000e+00
     20                8       -7.60291672e+01       0.000000e+00
     50                3       -7.60291672e+01       1.230696e-14
#
# Mean: 4.08601652e-04
# Block size    # of blocks         Mean                Error
      1              160       4.08601652e-04       1.798268e-06
      2               80       4.08601652e-04       1.924525e-06
      5               32       4.08601652e-04       1.699368e-06
     10               16       4.08601652e-04       1.987354e-06
     20                8       4.08601652e-04       1.876310e-06
     50                3       4.09390974e-04       7.804207e-07
# Stocahstic error estimate: 1.924525e-06
#
#
# Mean: -2.96702617e-04
# Block size    # of blocks         Mean                Error
      1              160       -2.96702617e-04       1.013550e-06
      2               80       -2.96702617e-04       1.096990e-06
      5               32       -2.96702617e-04       1.023067e-06
     10               16       -2.96702617e-04       7.998215e-07
     20                8       -2.96702617e-04       7.795846e-07
     50                3       -2.97142481e-04       5.272240e-07
# Stocahstic error estimate: 1.096990e-06
#
#
# Mean: -4.07365875e-04
# Block size    # of blocks         Mean                Error
      1              160       -4.07365875e-04       1.192792e-06
      2               80       -4.07365875e-04       1.230907e-06
      5               32       -4.07365875e-04       1.168498e-06
     10               16       -4.07365875e-04       1.494712e-06
     20                8       -4.07365875e-04       1.233226e-06
     50                3       -4.07710712e-04       1.068148e-06
# Stocahstic error estimate: 1.230907e-06
#
#
# Mean: -2.95466838e-04
# Block size    # of blocks         Mean                Error
      1              160       -2.95466838e-04       6.007705e-08
      2               80       -2.95466838e-04       5.953330e-08
      5               32       -2.95466838e-04       6.667009e-08
     10               16       -2.95466838e-04       6.645638e-08
     20                8       -2.95466838e-04       5.335328e-08
     50                3       -2.95462217e-04       3.530542e-08
# Stocahstic error estimate: 6.007705e-08
#
afqmc energy: -76.029167 +/-   None  
zero_orb_cr: 0.000409 +/- 0.000409
hf_orb_cr: -0.000297 +/- 0.000001
ccsd_orb_cr: -0.000407 +/- 0.000001
tot_orb_cr: -0.000295 +/- 0.000000
########### running fragment 2 ##########
    impsol:  1 LOs  21/24 MOs  4 occ  17 vir
    CPU time for imp sol - eri          0.02 sec, wall time      0.06 sec
    CPU time for imp sol - mp2 amp      0.02 sec, wall time      0.01 sec
    CPU time for imp sol - mp2 ene      0.00 sec, wall time      0.00 sec
    CPU time for imp sol - cc  amp      1.56 sec, wall time      0.94 sec
    CPU time for imp sol - cc  ene      0.02 sec, wall time      0.00 sec
# lno-ccsd correlation energy is: -0.03427469749986378
# Generating Cholesky Integrals
# frozen orbitals are [ 0 22 23]
# local active orbitals are [ 1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21]
# local active space size 21
# loc_eris shape: (441, 441)
# chol shape: (156, 441)
# Finished calculating Cholesky integrals

# Size of the correlation space:
# Number of electrons: (4, 4)
# Number of basis functions: 21
# Number of Cholesky vectors: 156

# Hostname: yichi-thinkpad
# System Type: Linux
# Machine Type: x86_64
# Processor: x86_64
# Number of MPI ranks: 8
#
# norb: 21
# nelec: (4, 4)
#
# n_eql: 5
# n_prop_steps: 30
# n_ene_blocks: 1
# n_sr_blocks: 10
# n_blocks: 20
# n_walkers: 50
# seed: 2
# walker_type: rhf
# trial: cisd
# dt: 0.01
# n_exp_terms: 6
# orbital_rotation: True
# do_sr: True
# symmetry: False
# save_walkers: False
# ene0: 0.0
# free_projection: False
# n_batch: 1
# maxError: 0.001
# use_gpu: False
#
# Hostname: yichi-thinkpad
# System Type: Linux
# Machine Type: x86_64
# Processor: x86_64
# afqmc propagation with ccsd trial using 400 walkers
# system relaxing and appraching the equilibrium of the Markov Chain
# eql_step 	 sys_energy 	 zero_orb_cr 	 hf_orb_cr 	 ccsd_orb_cr 	 tot_orb_cr 	 wall_time
    0	 	 -76.237719	 0.000000	 0.000000	 -0.034280	 -0.034280	    0.00
    1	 	 -76.240494	 0.169872	 -0.031283	 -0.172966	 -0.034377	   83.78 
    2	 	 -76.241989	 0.185758	 -0.033773	 -0.186429	 -0.034445	   154.08 
    3	 	 -76.241211	 0.178188	 -0.032588	 -0.179912	 -0.034312	   193.86 
    4	 	 -76.241669	 0.177124	 -0.032601	 -0.178909	 -0.034386	   233.71 
    5	 	 -76.241341	 0.176633	 -0.032082	 -0.178772	 -0.034221	   273.50 
# Sampling sweeps:
# iter 	 sys_energy 	 err 	 zero_orb_cr 	 err 	 hf_orb_cr 	 err 	 ccsd_orb_cr 	 err 	 tot_orb_cr 	 err 	 time
   0   -76.242088     None     0.181246   0.181246   -0.033096   0.000521   -0.182558   0.002424   -0.034408   0.000078  39.87 
   2   -76.241478   0.000262   0.181761   0.181761   -0.033211   0.000497   -0.182848   0.002369   -0.034298   0.000050  177.43 
   4   -76.241363   0.000196   0.180799   0.180799   -0.033031   0.000331   -0.182045   0.001572   -0.034277     None    256.24 
   6   -76.241432   0.000171   0.180224   0.180224   -0.032890   0.000263   -0.181604   0.001253   -0.034270   0.000045  334.64 
   8   -76.241331   0.000148   0.180004   0.180004   -0.032829   0.000211   -0.181431   0.001010   -0.034256   0.000036  413.16 
  10   -76.241210     None     0.179288   0.179288   -0.032698   0.000189   -0.180838   0.000900   -0.034248   0.000033  492.65 
  12   -76.241174   0.000132   0.178863   0.178863   -0.032616   0.000167   -0.180494   0.000797   -0.034247   0.000029  571.89 
  14   -76.241153     None     0.178876   0.178876   -0.032607   0.000156   -0.180509   0.000747   -0.034240   0.000027  651.36 
  16   -76.241166   0.000119   0.178900   0.178900   -0.032617   0.000143   -0.180537   0.000683   -0.034254   0.000025  731.16 
  18   -76.241172   0.000134   0.178563   0.178563   -0.032560   0.000135   -0.180264   0.000647   -0.034261   0.000023  810.50 
# Number of outliers in post: 0 
#
# Mean: -7.62411736e+01
# Block size    # of blocks         Mean                Error
      1              160       -7.62411736e+01       1.098331e-04
      2               80       -7.62411736e+01       1.157925e-04
      5               32       -7.62411736e+01       1.253984e-04
     10               16       -7.62411736e+01       1.252404e-04
     20                8       -7.62411736e+01       1.315836e-04
     50                3       -7.62411727e+01       1.717711e-04
# Stocahstic error estimate: 1.253984e-04
#
#
# Mean: 1.78517478e-01
# Block size    # of blocks         Mean                Error
      1              160       1.78517478e-01       7.479353e-04
      2               80       1.78517478e-01       7.025047e-04
      5               32       1.78517478e-01       6.788171e-04
     10               16       1.78517478e-01       5.773018e-04
     20                8       1.78517478e-01       6.134914e-04
     50                3       1.78541181e-01       1.069174e-03
# Stocahstic error estimate: 7.479353e-04
#
#
# Mean: -3.25525551e-02
# Block size    # of blocks         Mean                Error
      1              160       -3.25525551e-02       1.323366e-04
      2               80       -3.25525551e-02       1.284827e-04
      5               32       -3.25525551e-02       1.197612e-04
     10               16       -3.25525551e-02       1.041147e-04
     20                8       -3.25525551e-02       1.228075e-04
     50                3       -3.25580523e-02       2.426239e-04
# Stocahstic error estimate: 1.323366e-04
#
#
# Mean: -1.80227843e-01
# Block size    # of blocks         Mean                Error
      1              160       -1.80227843e-01       6.307681e-04
      2               80       -1.80227843e-01       5.901116e-04
      5               32       -1.80227843e-01       5.699147e-04
     10               16       -1.80227843e-01       4.798000e-04
     20                8       -1.80227843e-01       4.939574e-04
     50                3       -1.80241892e-01       8.356248e-04
# Stocahstic error estimate: 6.307681e-04
#
#
# Mean: -3.42629206e-02
# Block size    # of blocks         Mean                Error
      1              160       -3.42629206e-02       2.093309e-05
      2               80       -3.42629206e-02       2.255786e-05
      5               32       -3.42629206e-02       1.779648e-05
     10               16       -3.42629206e-02       2.023001e-05
     20                8       -3.42629206e-02       2.004484e-05
     50                3       -3.42587631e-02       2.679730e-05
# Stocahstic error estimate: 2.255786e-05
#
afqmc energy: -76.241174 +/- 0.000125
zero_orb_cr: 0.178517 +/- 0.178517
hf_orb_cr: -0.032553 +/- 0.000132
ccsd_orb_cr: -0.180228 +/- 0.000631
tot_orb_cr: -0.034263 +/- 0.000023
########### running fragment 3 ##########
    impsol:  1 LOs  21/24 MOs  4 occ  17 vir
    CPU time for imp sol - eri          0.06 sec, wall time      0.07 sec
    CPU time for imp sol - mp2 amp      0.02 sec, wall time      0.04 sec
    CPU time for imp sol - mp2 ene      0.00 sec, wall time      0.01 sec
    CPU time for imp sol - cc  amp      1.36 sec, wall time      0.93 sec
    CPU time for imp sol - cc  ene      0.00 sec, wall time      0.00 sec
# lno-ccsd correlation energy is: -0.06195802602997214
# Generating Cholesky Integrals
# frozen orbitals are [ 0 22 23]
# local active orbitals are [ 1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21]
# local active space size 21
# loc_eris shape: (441, 441)
# chol shape: (154, 441)
# Finished calculating Cholesky integrals

# Size of the correlation space:
# Number of electrons: (4, 4)
# Number of basis functions: 21
# Number of Cholesky vectors: 154

# Hostname: yichi-thinkpad
# System Type: Linux
# Machine Type: x86_64
# Processor: x86_64
# Number of MPI ranks: 8
#
# norb: 21
# nelec: (4, 4)
#
# n_eql: 5
# n_prop_steps: 30
# n_ene_blocks: 1
# n_sr_blocks: 10
# n_blocks: 20
# n_walkers: 50
# seed: 2
# walker_type: rhf
# trial: cisd
# dt: 0.01
# n_exp_terms: 6
# orbital_rotation: True
# do_sr: True
# symmetry: False
# save_walkers: False
# ene0: 0.0
# free_projection: False
# n_batch: 1
# maxError: 0.001
# use_gpu: False
#
# Hostname: yichi-thinkpad
# System Type: Linux
# Machine Type: x86_64
# Processor: x86_64
# afqmc propagation with ccsd trial using 400 walkers
# system relaxing and appraching the equilibrium of the Markov Chain
# eql_step 	 sys_energy 	 zero_orb_cr 	 hf_orb_cr 	 ccsd_orb_cr 	 tot_orb_cr 	 wall_time
    0	 	 -76.237680	 0.000000	 0.000000	 -0.061958	 -0.061958	    0.00
    1	 	 -76.240631	 0.380484	 -0.055654	 -0.388296	 -0.063466	   84.36 
    2	 	 -76.241287	 0.410555	 -0.058685	 -0.415602	 -0.063732	   154.86 
    3	 	 -76.241852	 0.434875	 -0.061356	 -0.437285	 -0.063766	   194.01 
    4	 	 -76.241463	 0.442406	 -0.061584	 -0.445003	 -0.064182	   233.08 
    5	 	 -76.240921	 0.424031	 -0.059499	 -0.428186	 -0.063654	   272.26 
# Sampling sweeps:
# iter 	 sys_energy 	 err 	 zero_orb_cr 	 err 	 hf_orb_cr 	 err 	 ccsd_orb_cr 	 err 	 tot_orb_cr 	 err 	 time
   0   -76.241714     None     0.436875     None     -0.061748     None     -0.438866     None     -0.063739     None    39.15 
   2   -76.241419   0.000276   0.436271   0.436271   -0.061263   0.001062   -0.438802   0.007777   -0.063794   0.000198  175.08 
   4   -76.241410   0.000242   0.426754   0.426754   -0.060209   0.000711   -0.430315   0.005254   -0.063770   0.000134  253.04 
